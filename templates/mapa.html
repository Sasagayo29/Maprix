<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Maprix - Gestão</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

    <header class="main-header">
        <div class="logo-area">
            <img src="https://tamandua.tv.br/assets/img/logo_kinross.png" alt="Logo" class="logo-img">
            <div class="vertical-divider"></div>
            <span class="system-name">MAPRIX</span>
        </div>
        <div class="user-info"><span><i class="fas fa-user-circle"></i> Gestor Operacional</span></div>
    </header>

    <div class="main-container">
        <aside class="sidebar-menu">
            <button class="menu-btn active" onclick="togglePanel('filtro')" title="Gestão"><i class="fas fa-filter"></i></button>
            <button class="menu-btn" onclick="carregarTudo()" title="Atualizar"><i class="fas fa-sync-alt"></i></button>
            <button class="menu-btn" onclick="togglePanel('ajuda')" title="Ajuda"><i class="fas fa-question-circle"></i></button>
        </aside>

        <div id="sidePanel" class="side-panel">
            <div class="panel-header">
                <h3 id="panelTitle">Painel</h3>
                <button class="close-panel" onclick="fecharPanel()"><i class="fas fa-times"></i></button>
            </div>
            
            <div id="content-filtro" class="panel-content">
                <div class="stats-container">
                    <div class="stat-card"><small>Equipamentos</small><strong id="statTotal">0</strong></div>
                    <div class="stat-card"><small>Registros</small><strong id="statRegistros">0</strong></div>
                </div>
                <div class="divider"></div>
                <label>Filtrar:</label>
                <select id="filtroEquipamento" class="styled-select"><option value="todos">Todos</option></select>
                <div class="divider"></div>
                <button class="btn-primary" onclick="exportarCSV()"><i class="fas fa-file-csv"></i> Exportar CSV</button>
                <div id="infoTimeline" class="info-box" style="display: none;">
                    <strong><i class="fas fa-route"></i> Rastreio:</strong> <span id="nomeTrajeto">--</span>
                </div>
            </div>

            <div id="content-ajuda" class="panel-content" style="display: none;">
                <p>Use o desenho para criar cercas. Clique nos pontos para editar.</p>
            </div>
        </div>

        <div id="map"></div>
    </div>

    <div id="modalEdicao" class="modal-overlay" style="display: none;">
        <div class="modal-card">
            <div class="modal-header"><h3>Editar Registro</h3><button onclick="fecharModal()"><i class="fas fa-times"></i></button></div>
            <div class="modal-body">
                <input type="hidden" id="editId">
                <label>Equipamento:</label><input type="text" id="editNome" class="styled-input">
                <label>Cor do Marcador:</label>
                <div class="color-picker-wrapper">
                    <input type="color" id="editCor" class="styled-color" value="#007bff"> <span>Selecionar Cor</span>
                </div>
                <label>Observação:</label><textarea id="editObs" class="styled-textarea" rows="3"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="fecharModal()">Cancelar</button>
                <button class="btn-save" onclick="salvarEdicao()">Salvar</button>
            </div>
        </div>
    </div>

    <div id="modalArea" class="modal-overlay" style="display: none;">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Nova Área Delimitada</h3>
                </div>
            
            <div class="modal-body">
                <label>Nome da Área / Talhão:</label>
                <input type="text" id="areaNome" class="styled-input" placeholder="Ex: Área Norte">
                
                <label>Cor da Delimitação:</label>
                <div class="color-picker-wrapper">
                    <input type="color" id="areaCor" class="styled-color" value="#FFC107">
                    <span>Cor da linha e preenchimento</span>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-cancel" onclick="cancelarDesenho()">Cancelar</button>
                <button class="btn-save" onclick="confirmarArea()">Salvar Área</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="{{ url_for('static', filename='js/mapa.js') }}"></script>
</body>
</html>